# =============================================================================
# CAD Bridge + pma-voice Voice Configuration
# =============================================================================
# Add these lines to your FiveM server.cfg.
#
# SETUP OVERVIEW (everything on one Windows VPS):
#
#   rust-mumble.exe  <-- managed by CAD (starts automatically, no manual setup)
#       |
#       +-- 127.0.0.1:64738  <-- CAD voice bridge (mumble-node) connects here
#       |
#       +-- 0.0.0.0:64738    <-- pma-voice in-game players connect here
#                                via voice_externalAddress in server.cfg
#
# The CAD auto-starts rust-mumble.exe from server/murmur/rust-mumble.exe when
# MUMBLE_MANAGE=true is set in .env. Port 64738 TCP+UDP must be open
# in Windows Firewall and your VPS provider's security group.
#
# TIP: Set FIVEM_SERVER_PATH in .env to have the CAD automatically write
# voice.cfg to your FiveM server folder and keep it up to date on restart.
# =============================================================================
# STEP 1: Open port 64738 in Windows Firewall (run in PowerShell as Admin):
#
#   netsh advfirewall firewall add rule name="Mumble Voice" protocol=TCP dir=in localport=64738 action=allow
#   netsh advfirewall firewall add rule name="Mumble Voice UDP" protocol=UDP dir=in localport=64738 action=allow
#
# Also open port 64738 in your VPS provider's security group / network firewall.
# =============================================================================

# =============================================================================
# STEP 2: Configure pma-voice to use the managed Mumble server
# =============================================================================
# Replace 103.203.241.35 with your VPS public IP.
# voice_externalPort must match MUMBLE_PORT in your CAD .env (default 64738).

setr voice_externalAddress "103.203.241.35"
setr voice_externalPort 64738
setr voice_allowSetIntent 1
setr voice_hideEndpoints 1

# voice_use2dAudio prevents pma-voice from auto-overriding to native audio mode.
# rust-mumble handles FiveM voice targets natively so proximity works correctly.
setr voice_use2dAudio true

# =============================================================================
# STEP 3: Configure the CAD bridge resource
# =============================================================================

set cad_bridge_base_url "http://127.0.0.1:3030"
set cad_bridge_token "Ku3xaT6MVe+GgGC9qQu2bMbdqBEPY7cXCyRd3WISCjA="

# NPWD 000 emergency number interception
set cad_bridge_npwd_emergency_numbers "000"
set cad_bridge_npwd_resource "npwd"

# Fine + job sync
set cad_bridge_fine_adapter "auto"
set cad_bridge_job_sync_adapter "auto"

# =============================================================================
# STEP 4: Ensure the resource starts
# =============================================================================

ensure cad_bridge
